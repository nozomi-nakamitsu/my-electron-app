<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Hello World!</title>
  <link rel="stylesheet" href="index.css">
  <script src="AgoraRTC_N-4.3.0.js"></script>
  <script src="agora-rtm-sdk-1.4.1.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.css" />
  <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="https://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.js"></script>
</head>

<body>
  <div id="div_join" role="main" class="ui-content">
    <div class="ui-field-contain">
      <label for="entry_comment">UID:</label>
      <input type="text" id="loginId" size="15" pattern="^[0-9A-Za-z]+$" />
    </div>
    <fieldset class="ui-grid-a">
      <div class="ui-block-a"><button id="login" onclick="login()" class="ui-btn ui-btn-b"
          style='float: right;width: 200px;'>Login</button></div>
    </fieldset>
  </div>
</body>
<script>
  var client = AgoraRTC.createClient({ mode: "live", codec: "vp8", role: "host" });

  // var localTracks = {
  //   videoTrack: null,
  //   audioTrack: null
  // };
  // var remoteUsers = {};

  // Agora client options
  var options = {
    appid: "2a4e9255decc40dd9e11a410e2b832bf",
    channel_rtm: "demo",
    channel: null,
    uid: null,
    token: null
  };

  // var camera, microphone;
  // var clientRtm, channelRtm, currentMessage;
  // var random = Math.floor(Math.random() * 99999) + 1;
  // var uidRtm;

  function login() {
    //Create an Instance and Channel
    clientRtm = AgoraRTM.createInstance(options.appid);
    channelRtm = clientRtm.createChannel(options.channel_rtm);

    //Set a listener to the connection state change
    clientRtm.on("ConnectionStateChange", function (newState, reason) {
      console.log("on connection state changed to " + newState + " reason:" + reason);
    });
    //Log in the Agora RTM system
    if ($("#loginId").val() == "") {
      $("#loginId").val(random);
    }
    uidRtm = $("#loginId").val();
    //channelName=uidRtm;
    options.uid = $("#loginId").val();
    options.channel = $("#loginId").val();

    console.log("uidRtm:" + options.uid);
    clientRtm.login({ uid: options.uid, token: options.token }).then(function () {
      console.log("AgoraRTM client login success");
      channelRtm.join().then(function () {
        console.log("AgoraRTM client join success");
        appendProc(options.uid, options.uid + "(you)");
        receiveChannelMessage();
      }).catch(function (err) {
        console.log("AgoraRTM client join failure, ", err);
      });

    }).catch(function (err) {
      console.log("AgoraRTM client login failure, ", err);
    });
    window.location.href = '/Users/nakamitsunozomi/Desktop/my-electron-app/src/AgoraWebSDK-NG/Demo/index.html?uid=' + options.uid;


  }
</script>

</html>